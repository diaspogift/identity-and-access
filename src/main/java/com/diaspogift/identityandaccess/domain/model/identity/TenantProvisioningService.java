package com.diaspogift.identityandaccess.domain.model.identity;import com.diaspogift.identityandaccess.domain.model.access.Role;import com.diaspogift.identityandaccess.domain.model.access.RoleRepository;import com.diaspogift.identityandaccess.domain.model.common.DomainEventPublisher;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.stereotype.Service;@Servicepublic class TenantProvisioningService {    public static final String DG_ADMINISTRATOR = "DG_ADMINISTRATOR";    public static final String ADMINISTRATOR = "ADMINISTRATOR";    public static final String DG_REP = "DG_REP";    public static final String DG_GES = "DG_GES";    public static final String ADMIN_USERNAME = "admin";    public static final String USER_USERNAME = "user";    public static final String DEFAULT = "Default";    public static final String ADMINISTRATOR_DESCRIPTION = "administrator";    public static final String USER_DESCRIPTION = "user";    @Autowired    private RoleRepository roleRepository;    @Autowired    private TenantRepository tenantRepository;    @Autowired    private UserRepository userRepository;    public Tenant provisionTenant(String aTenantName, String aTenantDescription, FullName anAdministorName, EmailAddress anEmailAddress, PostalAddress aPostalAddress, Telephone aPrimaryTelephone, Telephone aSecondaryTelephone) {        try {            Tenant tenant = new Tenant(                    this.tenantRepository().nextIdentity(),                    aTenantName,                    aTenantDescription,                    true); // must be active to register admin            this.tenantRepository().add(tenant);            this.registerAdministratorFor(                    tenant,                    anAdministorName,                    anEmailAddress,                    aPostalAddress,                    aPrimaryTelephone,                    aSecondaryTelephone);            //TODO PASS SPECIFIC PARAM FOR DEFAULT USER ROLEEEEEEE            //TODO PASS SPECIFIC PARAM FOR DEFAULT USER ROLEEEEEEE            //TODO PASS SPECIFIC PARAM FOR DEFAULT USER ROLEEEEEEE            //TODO PASS SPECIFIC PARAM FOR DEFAULT USER ROLEEEEEEE            //TODO PASS SPECIFIC PARAM FOR DEFAULT USER ROLEEEEEEE            if (!"DASPOGIFT".equals(tenant.name())) {                this.registerUserFor(                        tenant,                        new FullName("Default", "USer"),                        new EmailAddress("user.default@gmail.com"),                        new PostalAddress("StreetAddress", "City", "StateProvince", "80210", "CM"),                        new Telephone("CM", "00237", "669262656"),                        new Telephone("CM", "00237", "669262656")                );            } else {                this.registerUserFor(                        tenant,                        new FullName("Default", "USer"),                        new EmailAddress("user.default@gmail.com"),                        new PostalAddress("StreetAddress", "City", "StateProvince", "80210", "CM"),                        new Telephone("CM", "00237", "669262656"),                        new Telephone("CM", "00237", "669262656")                );            }            DomainEventPublisher                    .instance()                    .publish(new TenantProvisioned(                            tenant.tenantId()));            return tenant;        } catch (Throwable t) {            throw new IllegalStateException("Cannot provision tenant because: " + t.getMessage());        }    }    private void registerAdministratorFor(            Tenant aTenant,            FullName anAdministorName,            EmailAddress anEmailAddress,            PostalAddress aPostalAddress,            Telephone aPrimaryTelephone,            Telephone aSecondaryTelephone) {        RegistrationInvitation invitation =                aTenant.offerRegistrationInvitation("init", new EmailAddress("felicien.fotiomanfo@gmail.com")).openEnded();/*        String strongPassword =                DomainRegistry                        .passwordService()                        .generateStrongPassword();*/        String strongPassword = "123456";        System.out.println("\n\n HERE THE GENERATED PASSWORD FOR TENANT  " + aTenant.tenantId() + " == " + strongPassword + "\n\n");        User admin =                aTenant.registerUser(                        invitation.invitationId(),                        (ADMIN_USERNAME),                        strongPassword,                        Enablement.indefiniteEnablement(),                        new Person(                                anAdministorName,                                new ContactInformation(                                        anEmailAddress,                                        aPostalAddress,                                        aPrimaryTelephone,                                        aSecondaryTelephone)));        aTenant.withdrawInvitation(invitation.invitationId());        this.userRepository().add(admin);        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        Role adminRole =                aTenant.provisionRole(                        ("DASPOGIFT".equals(aTenant.name()) ? DG_ADMINISTRATOR : ADMINISTRATOR),                        DEFAULT + " " + aTenant.name() + " " + ADMINISTRATOR_DESCRIPTION + ".");        adminRole.assignUser(admin);        this.roleRepository().add(adminRole);        DomainEventPublisher.instance().publish(                new TenantAdministratorRegistered(                        aTenant.tenantId(),                        aTenant.name(),                        anAdministorName,                        anEmailAddress,                        admin.username(),                        strongPassword));    }    private void registerUserFor(            Tenant aTenant,            FullName anUserName,            EmailAddress anEmailAddress,            PostalAddress aPostalAddress,            Telephone aPrimaryTelephone,            Telephone aSecondaryTelephone) {        RegistrationInvitation invitation =                aTenant.offerRegistrationInvitation("init", new EmailAddress("felicien.fotiomanfo@gmail.com")).openEnded();/*         String strongPassword =                DomainRegistry                        .passwordService()                        .generateStrongPassword();*/        String strongPassword = "123456";        System.out.println("\n\n HERE THE GENERATED PASSWORD FOR TENANT  " + aTenant.tenantId() + " == " + strongPassword + "\n\n");        User user =                aTenant.registerUser(                        invitation.invitationId(),                        (USER_USERNAME),                        strongPassword,                        Enablement.indefiniteEnablement(),                        new Person(                                anUserName,                                new ContactInformation(                                        anEmailAddress,                                        aPostalAddress,                                        aPrimaryTelephone,                                        aSecondaryTelephone)));        aTenant.withdrawInvitation(invitation.invitationId());        this.userRepository().add(user);        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        //TODO SHOULD REVIEW THE CREATION OF THIS ROLEEEEEEEE        Role userRole =                aTenant.provisionRole(("DASPOGIFT".equals(aTenant.name()) ? DG_GES : DG_REP), DEFAULT + " " + aTenant.name() + " " + USER_DESCRIPTION + ".");        userRole.assignUser(user);        this.roleRepository().add(userRole);        DomainEventPublisher.instance().publish(                new TenantAdministratorRegistered(                        aTenant.tenantId(),                        aTenant.name(),                        anUserName,                        anEmailAddress,                        user.username(),                        strongPassword));    }    private RoleRepository roleRepository() {        return this.roleRepository;    }    private TenantRepository tenantRepository() {        return this.tenantRepository;    }    private UserRepository userRepository() {        return this.userRepository;    }}